from flask import Flask, request, jsonify, render_template, redirect, url_for
from markupsafe import escape  # Updated import
import requests
from flask_cors import CORS
from flask_mysqldb import MySQL
import os

app = Flask(__name__)

# Set MySQL configuration from environment variables
app.config['MYSQL_HOST'] = os.getenv('MYSQL_HOST', 'localhost')
app.config['MYSQL_USER'] = os.getenv('MYSQL_USER', 'root')
app.config["MYSQL_PASSWORD"] = os.getenv('MYSQL_PASSWORD', '')
app.config["MYSQL_DB"] = os.getenv('MYSQL_DB', 'flaskapp')

mysql = MySQL(app)
CORS(app)

@app.route("/test", methods=['GET', 'POST'])
def test():
    cur = mysql.connection.cursor()
    data = request.get_json()
    print("JSON:")
    print(data)
    Id = data['Id']
    nm = data['nm']
    email = data['nm1']
    print(Id, nm, email)
    query = "INSERT INTO users VALUES({}, '{}', '{}')".format(Id, nm, email)
    print(query)
    cur.execute(query)
    cur.execute("SELECT * FROM users")
    fetchdata = cur.fetchall()
    print(fetchdata)
    mysql.connection.commit()
    cur.close()
    return data

if __name__ == "__main__":
    app.run(debug=True, port=5000, host='0.0.0.0')
